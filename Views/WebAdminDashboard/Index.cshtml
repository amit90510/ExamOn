
@{
    ViewBag.Title = "ExamOn - Web Admin";
}
<a class="btn btn-danger" href="~/signout"> Logout from web admin?</a>
<hr />
<script src="~/Scripts/gijgo.min.js" type="text/javascript"></script>
<link href="~/Content/gijgo.min.css" rel="stylesheet" type="text/css" />
<script src="~/Scripts/select2.min.js" type="text/javascript"></script>
<link href="~/Content/select2.min.css" rel="stylesheet" type="text/css" />
<div class="input-group container" error-For="Tenant">
    <select style="cursor:pointer" id="txtTenant" class="form-select js-example-basic-single" onchange="OnTenantCHange(this)">
        <option>Choose...</option>
    </select>
</div>
<br />
<hr />
<div class="accordion accordion-flush" id="accordionFlushExample">
    <div class="accordion-item">
        <h2 class="accordion-header" id="flush-headingOne">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                Update Tenant (you can perform this operation once you have create tenant DB and a recordin tenant Master table)
            </button>
        </h2>
        <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
            <div class="accordion-body">
                Tenant ID
                <input type="text" class="form-control" id="txtTenantId" placeholder="tenant ID (can not be changed)" readonly="readonly" style="background-color:grey !important">
                Tenant Name
                <input type="text" class="form-control" id="txtTenantName" placeholder="tenant Name">
                Address
                <input type="text" class="form-control" id="txtAddress" placeholder="tenant Address">
                Mobile
                <input type="number" class="form-control" id="txtTenantMobile" placeholder="tenant Mobile">
                Email
                <input type="text" class="form-control" id="txtTenantEMail" placeholder="tenant Email">
                Subscription  End date
                <input type="text" class="form-control" readonly="readonly" id="txtSubscriptionENdDate" placeholder="Subcription end Date" width="312">

                <script>
                    /*  $('#txtSubscriptionENdDate').datetimepicker({ footer: true, modal: false, header: true, format: "dd-mm-yyyy hh:MM tt" });*/
                    $('#txtSubscriptionENdDate').datepicker({ footer: true, modal: false, header: true, format: "dd-mm-yyyy" });
                </script>
                Subscription End Message
                <input type="text" class="form-control" id="txtTenantsubscriptionEndMessage" placeholder="tenant subscription end message">
                Last Recharge Amount
                <input type="number" class="form-control" id="txtTenantLastRecharge" placeholder="Last Recharge Amount">
                <br />

                <button class="btn btn-danger" onclick="UpdateTenant()">Update</button>
            </div>
        </div>
    </div>
    <div class="accordion-item">
        <h2 class="accordion-header" id="flush-headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                Create Instructor/Teacher/Tenant Admin Login
            </button>
        </h2>
        <div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo" data-bs-parent="#accordionFlushExample">
            <div class="accordion-body">
                <select style="cursor:pointer" id="txtloginType" class="form-select" onchange="">
                    <option>Choose login type...</option>
                </select>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(() => {
        $('.js-example-basic-single').select2({ width: 'resolve' });
        ServerData("/WebAdminDashboard/GetAllTenants", "Post", null, (data) => {
            if (data && data.StatusCode == "1") {
                $('#txtTenant').html('');
                $('#txtTenant').append($("<option selected></option>").attr("value", "").text('Choose Tenant first'));
                $.each(data.Data, function (key, value) {
                    $('#txtTenant').append($("<option></option>").attr("value", value.TenantUniqueKey).text(value.TenantDBName));
                });
            }
        }, () => { });

        ServerData("/WebAdminDashboard/GetAllLoginType", "Post", null, (data) => {
            if (data && data.StatusCode == "1") {
                $('#txtloginType').html('');
                $('#txtloginType').append($("<option selected></option>").attr("value", "").text('Choose login type first'));
                $.each(data.Data, function (key, value) {
                    $('#txtloginType').append($("<option></option>").attr("value", value.Type).text(value.TypeName));
                });
            }
        }, () => { });
    });

    function OnTenantCHange(select) {
        if (select && select.value) {
            var loginObj = {
                "TenantUniqueKey": select.value.trim()
            }
            ServerData("/WebAdminDashboard/GetTenantDetails", "Post", loginObj, (data) => {
                if (data && data.StatusCode == "1") {
                    $("#txtTenantId").val(data.Data.id);
                    $("#txtTenantName").val(data.Data.TenantName);
                    $("#txtAddress").val(data.Data.TenantAddress);
                    $("#txtTenantMobile").val(data.Data.TenantMobile);
                    $("#txtTenantEMail").val(data.Data.TenantEmail);
                    $("#txtTenantLastRecharge").val(data.Data.RechargeAmount);
                    $("#txtTenantsubscriptionEndMessage").val(data.Data.SubscriptionEndMessage);
                    $("#txtSubscriptionENdDate").val(toShowSqlDateinUI(data.Data.SubscriptionEndDate));
                }
            }, () => { });
        } else {
            $("#txtTenantId").val('');
            $("#txtTenantName").val('');
            $("#txtAddress").val('');
            $("#txtTenantMobile").val('');
            $("#txtTenantEMail").val('');
            $("#txtTenantLastRecharge").val('');
            $("#txtTenantsubscriptionEndMessage").val('');
            $("#txtSubscriptionENdDate").val(toShowSqlDateinUI(''));
        }
    }

    function UpdateTenant() {
        if ($("#txtTenantId").val() && $("#txtTenant").val()) {
            var PassObj = {
                "id": $("#txtTenantId").val().trim(),
                "TenantName": $("#txtTenantName").val().trim(),
                "TenantAddress": $("#txtAddress").val().trim(),
                "TenantAddress": $("#txtAddress").val().trim(),
                "TenantEmail": $("#txtTenantEMail").val().trim(),
                "TenantMobile": $("#txtTenantMobile").val().trim(),
                "SubscriptionEndMessage": $("#txtTenantsubscriptionEndMessage").val().trim(),
                "RechargeAmount": $("#txtTenantLastRecharge").val().trim(),
                "SubscriptionEndDate": toSaveSqlDBDateFormat($("#txtSubscriptionENdDate").val().trim())
            }
            ServerData("/WebAdminDashboard/SaveTenantDetails", "Post", PassObj, (data) => {
                if (data && data.StatusCode == "1") {
                    OnTenantCHange(document.getElementById('txtTenant'));
                    SwalFire('Tenant details Updated', 'Updated', 'success', null, () => { }, "");
                } else {
                    SwalFire('Tenant details not found', data.Error, 'error', null, () => { }, "");
                }
            }, () => { });
        } else {
            SwalFire('Tenant details not found', 'details not found, either you did not select any tenant or data not found for selected tenant', 'error', null, () => { }, "");
        }
    }
</script>